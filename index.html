<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Energy Tracker</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="stylesheet.css">
        <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
        <script src="https://unpkg.com/vue-cookies@1.7.4/vue-cookies.js"></script>
    </head>
    <body>
        <div id="app">
            <div class="centered">
                <div id="energyText">
                    <p>ENERGY</p>
                    <p id="energyCount"> {{ energy }} </p>
                </div>
                <button @click="energy += 1; updateCookies()">Add 1 Energy</button>
                <button @click="addCard()">Add Card</button>
                <button @click="removeEnergy()">Remove 1 Energy</button>
                <button class="rollButton" @click="rollDie()">Roll Die</button>
                <button class="resetEnergy" @click="energy = 5; updateCookies()">Reset Energy</button>
                <div id="rollHistory">
                    <p> {{ results.join(', ') }} </p>
                    <button class="clearHistory" @click="results = []; updateCookies()">Clear Roll History</button>
                </div>
                <div class="cardDiv">
                    <div class="card" v-for="(card, index) in cards">
                        <a href="javascript:void(0);" @click="deleteCard(card, index)">
                            <img :src="'./cards/' + card.name + '.png'" class="cardImage" alt="card">
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <script>

            /* -- List of all cards in JSON format -- */

            const allCards =
                {
                    "common": [

                        {"name": "EvadeTrap", "cost": 3},
                        {"name": "CommonTeleport", "cost": 5},
                        {"name": "Rum", "cost": -3},
                        {"name": "RockSolidCommon", "cost": 3},
                        {"name": "WeakPoison", "cost": 2}

                    ],
                    "uncommon": [

                        {"name": "DisarmTrap", "cost": 3},
                        {"name": "RareTeleport", "cost": 4},
                        {"name": "AgedRum", "cost": -5},
                        {"name": "QuestionableRum", "cost": 5},
                        {"name": "RockSolidRare", "cost": 5},
                        {"name": "Disrupt", "cost": 5},
                        {"name": "PotentPoison", "cost": 3},
                        {"name": "Glue", "cost": 3},
                        {"name": "Switcheroo", "cost": 6},
                        {"name": "Dejavu", "cost": 4}

                    ],
                    "rare": [

                        {"name": "LegendaryTeleport", "cost": 3},
                        {"name": "CaptainsRum", "cost": -7},
                        {"name": "Eyepatch", "cost": 4},
                        {"name": "RockSolidLegendary", "cost": 6},
                        {"name": "DisruptLegendary", "cost": 6},
                        {"name": "SleepDart", "cost": 4},
                        {"name": "TheOlSwitcheroo", "cost": 6},
                        {"name": "Abduct", "cost": 5}

                    ],
                    "epic": [

                        {"name": "Blackout", "cost": 8},
                        {"name": "DisruptEpic", "cost": 8}

                    ]
                }

            /* -------- Actual Vue Instance --------- */

            new Vue({
                el: '#app',
                data: {
                    possibleCards: allCards, // Assigns cards in variable above to vue datapoint
                    energy: 5,
                    results: [],
                    cards: []
                },
                // Read cookies
                beforeMount() {
                    if ($cookies.get('energy')) {
                        this.energy = parseInt($cookies.get('energy'))
                    }
                    if ($cookies.get('results')) {
                        this.results = ($cookies.get('results')).split(',')
                    }
                    if ($cookies.get('cards')) {
                        this.cards = JSON.parse($cookies.get('cards'))
                    }
                },
                // Main functions
                methods: {
                    // Adds a random card
                    addCard() {
                        let card = this.rnd()
                        let name = card[0] + '/' + card[1].name
                        let cost = card[1].cost
                        this.cards.push({"name": name, "cost": cost})
                        this.updateCookies()
                    },
                    rnd() {
                        let num = Math.floor(Math.random() * 100)
                        let rarity
                        if (num <= 50) rarity = 'common'
                        else if (num <= 80) rarity = 'uncommon'
                        else if (num <= 95) rarity = 'rare'
                        else rarity = 'epic'
                        return [rarity, this.selectImage(rarity)]
                    },
                    selectImage(num){
                        let commonC = this.possibleCards.common,
                            uncommonC = this.possibleCards.uncommon,
                            rareC = this.possibleCards.rare,
                            epicC = this.possibleCards.epic
                        switch (num) {
                            case 'common':
                                let c = Math.floor(Math.random() * commonC.length);
                                return commonC[c]
                            case 'uncommon':
                                let u = Math.floor(Math.random() * uncommonC.length)
                                return uncommonC[u]
                            case 'rare':
                                let r = Math.floor(Math.random() * rareC.length)
                                return rareC[r]
                            case 'epic':
                                let e = Math.floor(Math.random() * epicC.length)
                                return epicC[e]
                        }
                    },
                    // Plays selected card and removes energy based on the cost
                    deleteCard(card, i) {
                        if (this.energy >= card.cost) {
                            this.energy -= card.cost
                            this.cards.splice(i,1)
                            this.updateCookies()
                        } else {

                        }
                    },
                    // Removes Energy if possible
                    removeEnergy() {
                        if (this.energy > 0) {
                            this.energy -= 1
                        }
                        this.updateCookies()
                    },
                    // Rolls random number between 1-6
                    rollDie() {
                        let rolled = Math.floor(Math.random() * 6) + 1
                        this.energy += rolled
                        this.results = this.results.concat(rolled)
                        this.updateCookies()

                    },
                    // Sets cookies to new values
                    updateCookies() {
                        $cookies.set('energy', this.energy)
                        $cookies.set('results', this.results)
                        $cookies.set('cards', JSON.stringify(this.cards))
                    },
                }
            })
        </script>
    </body>
</html>
